# Hatena-Blog-Workflows-Boilerplate(β)
- このBoilerplateは、企業がはてなブログで技術ブログを運営する際のレビューや公開作業など、運営ワークフローを支援する目的で作成しています
- GitHub 上で、はてなブログとの記事の同期、下書きの作成・編集・公開、公開記事の編集などを行うことができます。下書きの作成時にプルリクエストが作成されるため、記事のレビューなどの業務のワークフローに組み込むことが容易になります
- 本機能はベータ版です。正常に動作しない可能性がありますが、予めご了承下さい


# セットアップ

1. `blogsync.yaml`の各種項目を記述してください
    - `<BLOG DOMAIN>` にはブログのドメインを指定してください
    - `<BLOG OWNER HATENA ID>` にはブログのオーナー(ブログ作成者)のはてなIDを指定してください
```yaml
<BLOG DOMAIN>:
  username: <BLOG OWNER HATENA ID>
default:
  local_root: entries
```
2. GitHub リポジトリの 「`Secrets and variables` > `Repository variables`」 から以下のVariableを登録する
    - Name: `BLOG_DOMAIN` 
    - Value: ブログのドメインを指定してください 例) staff.hatenablog.com
3. GitHub リポジトリの 「`Secrets and variables` > `Repository Secrets`」 から以下のSecretを登録する
    - Name: `OWNER_API_KEY`
    - Secret: ブログのオーナーはてなアカウントの APIキーを指定してください
        - APIキーは、ブログオーナーアカウントでログイン後、[アカウント設定](https://blog.hatena.ne.jp/-/config) よりご確認いただけます
4. リポジトリにはてなブログの記事を同期させる
    - Actions から `initialize` を選択する
    - Run workflow をクリック
    - `Branch: main` が指定されていることを確認し、`Run workflow`ボタンをクリック
    - 全記記事が含まれたプルリクエストが作成されます。これをマージしてはてなブログとリポジトリの状況を同期させてください


# 想定ワークフロー

このツールで想定している下書き作成から記事公開までのワークフローは以下のとおりです。

1. 下書きを作成する
2. 下書き記事をプルリクエスト上で編集する
3. 適宜レビューなどを行い、通れば次の公開手順に進む
4. 下書き記事を公開する


# 手順の詳細

## 下書きの作成
下書きの作成方法は以下の2通りの方法があります。

- ブログメンバーが個人のアカウントで投稿する(記事の署名は個人のアカウントになります)
- ブログオーナーのアカウントで投稿する(記事の署名はブログオーナーアカウントになります)

それぞれ、下書き作成の手順が異なります。ブログの運営方針に沿った方法を選択してください。

### ブログメンバーが個人のアカウントで投稿する場合

1. 投稿したいブログの編集画面を開く
2. 下書き記事の記事タイトルを `{{username}}-{{日付}}` 等、ユニークな記事タイトルに設定し、クリップボードにコピーしておく
3. 下書きを投稿する
4. `pull draft from hatenablog` の workflow_dispatch を選択し、`Draft Entry Title`に先程コピーしたタイトルを設定し、実行する
5. 投稿した下書きを含むプルリクエストが作成される

### ブログオーナーのアカウントで投稿する場合

1. `create draft` workflow_dispatch を選択し、`Title`に記事タイトルを設定し、実行する
2. 作成した下書きを含むプルリクエストが作成される

## 下書き記事の編集
- 手順「下書きの作成」で作成したプルリクエスト上で記事を編集してください
- はてなブログでプレビューできるようにするため、下書き記事に限りプッシュされた時点ではてなブログに同期されます
- 記事の編集画面の URL は、プルリクエストに記載されています。編集画面に遷移した後、下書きプレビューの URL を発行し、プルリクエストの概要に記載しておくとプレビューが容易になります

## 下書き記事の公開
- 下書き記事の `Draft: true` 行を削除し、プルリクエストを main ブランチにマージすると公開されます

## 既存記事を修正する場合
- 修正ブランチを作成し、main ブランチにマージすると修正が反映されます



# workflow に関する詳細

- 各 workflow では下記で提供されている Reusable workflows を利用しています
  - https://github.com/hatena/hatenablog-workflows
